<html>
  <head>
    <script>
      function loadNextPage() {
        if (location.search.includes("testAsyncLength=true")) {
          var shell = SpecialPowers.wrap(window).docShell;
          var shistory = SpecialPowers.do_QueryInterface(shell, "nsIWebNavigation").sessionHistory;
          shistory.asyncHistoryLength = true;
        }
        opener.postMessage({ initialLength: history.length}, "*");
        location.href = 'file_history_length_during_pageload_2.html';
      }
    </script>
  </head>
  <body onload="setTimeout(loadNextPage);">
  </body>
</html>
