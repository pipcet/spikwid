<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <title>Test basic autofill</title>
  <script src="/tests/SimpleTest/SimpleTest.js"></script>
  <script src="/tests/SimpleTest/EventUtils.js"></script>
  <script type="text/javascript" src="../formautofill_common.js"></script>
  <script type="text/javascript" src="../../../../../..//toolkit/components/satchel/test/satchel_common.js"></script>
  <link rel="stylesheet" type="text/css" href="/tests/SimpleTest/test.css" />
</head>
<body>
Form autofill test: deciding something is not a CC form field

<script>
"use strict";

const MOCK_STORAGE = [{
  "cc-name": "John Doe",
  "cc-number": "4929001587121045",
  "cc-exp-month": 4,
  "cc-exp-year": 2017,
  "cc-type": "visa",
}, {
  "cc-name": "Timothy Berners-Lee",
  "cc-number": "5103059495477870",
  "cc-exp-month": 12,
  "cc-exp-year": 2022,
  "cc-type": "mastercard",
}];

async function setupCreditCardStorage() {
  await addCreditCard(MOCK_STORAGE[0]);
  await addCreditCard(MOCK_STORAGE[1]);
}

initPopupListener();

// Make sure we didn't make it impossible for it to say "this isn't a CC field"
// in the course of integrating the Fathom ruleset. This is a test of the
// integration process, not of the ruleset, which is tested by the Fathom
// training tools.
add_task(async function check_negative_result_is_possible() {
  await setupCreditCardStorage();
  // Register hook that freaks out if there is a popup:
  const noPopup = notExpectPopup();
  // Focus input field:
  await setInput("#vegetable", "");  // As soon as you do this, the popup shows.
  // Pause to allow popup to show, if it hasn't already:
  await noPopup;
});
</script>

<p id="display"></p>

<div id="content">
  <form id="form1">
    <p>This is not a credit-card form.</p>
    <p><label>Vegetable: <input id="vegetable"></label></p>
  </form>
</div>

<pre id="test"></pre>
</body>
</html>
